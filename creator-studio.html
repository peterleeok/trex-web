<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creator Studio | Trex.so</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&family=Montserrat:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css/spacex-design-system.css">
    <style>
        .tab-button.active {
            color: #00AEF0;
            border-bottom: 2px solid #00AEF0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .asset-card:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-black text-white">

<!-- Navigation -->
<nav class="fixed w-full bg-black/95 backdrop-blur-sm z-50 border-b border-minimal">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
            <div class="flex items-center">
                <a href="index.html" class="flex items-center space-x-3 group">
                    <img src="images/trex-logo-full.png" alt="Trex.so - Travel. Assemble. Play." class="h-12 md:h-16 w-auto transition-opacity group-hover:opacity-80">
                </a>
            </div>
            
            <div class="hidden md:flex items-center space-x-10">
                <a href="index.html" class="nav-link">홈</a>
                <a href="upload.html" class="nav-link">경험 업로드</a>
                <a href="market.html" class="nav-link">블록 마켓</a>
                <a href="creator-studio.html" class="text-cyan-accent font-semibold text-sm tracking-tight">크리에이터 스튜디오</a>
            </div>
            
            <div class="flex items-center space-x-4">
                <div id="authButtons" class="hidden md:block"></div>
                <button id="mobileMenuBtn" class="md:hidden text-white hover:text-cyan-accent focus:outline-none">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
        </div>
    </div>
    
    <div id="mobileMenu" class="hidden md:hidden bg-black border-t border-minimal">
        <div class="px-4 py-6 space-y-4">
            <a href="index.html" class="block nav-link py-2">홈</a>
            <a href="upload.html" class="block nav-link py-2">경험 업로드</a>
            <a href="market.html" class="block nav-link py-2">블록 마켓</a>
            <a href="creator-studio.html" class="block text-cyan-accent font-semibold py-2 text-sm tracking-tight">크리에이터 스튜디오</a>
            <div id="authButtonsMobile"></div>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="pt-28 pb-12 px-4 max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-12 fade-in-section">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
            <div>
                <h1 class="text-2xl md:text-3xl font-black tracking-tighter mb-2">
                    CREATOR <span class="text-cyan-accent">RECORD</span>
                </h1>
                <p class="text-white/60 text-xs tracking-tight">당신의 디지털 자산을 한눈에</p>
            </div>
            <a href="upload.html" class="mt-4 md:mt-0 bg-cyan-accent text-black px-5 py-2.5 btn-sharp font-bold hover-glow transition tracking-tight text-xs">
                <i class="fas fa-plus mr-2"></i>새 블록 생성
            </a>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12 fade-in-section">
        <div class="bg-dark-card border border-minimal p-6 hover:border-cyan-accent transition">
            <div class="text-white/60 text-xs tracking-tight mb-2">총 블록 수</div>
            <div id="totalBlocks" class="text-2xl font-black text-cyan-accent tracking-tighter">0</div>
        </div>
        <div class="bg-dark-card border border-minimal p-6 hover:border-cyan-accent transition">
            <div class="text-white/60 text-xs tracking-tight mb-2">총 수익</div>
            <div id="totalRevenue" class="text-2xl font-black text-cyan-accent tracking-tighter">$0</div>
        </div>
        <div class="bg-dark-card border border-minimal p-6 hover:border-cyan-accent transition">
            <div class="text-white/60 text-xs tracking-tight mb-2">총 판매</div>
            <div id="totalSales" class="text-2xl font-black text-cyan-accent tracking-tighter">0</div>
        </div>
        <div class="bg-dark-card border border-minimal p-6 hover:border-cyan-accent transition">
            <div class="text-white/60 text-xs tracking-tight mb-2">평균 평점</div>
            <div id="avgRating" class="text-2xl font-black text-cyan-accent tracking-tighter">0.0</div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="border-b border-minimal mb-8 fade-in-section">
        <div class="flex space-x-8 overflow-x-auto">
            <button class="tab-button active py-3 px-2 font-bold text-xs tracking-tight transition whitespace-nowrap" data-tab="assets">
                ASSET MANAGEMENT
            </button>
            <button class="tab-button py-3 px-2 font-bold text-xs tracking-tight text-white/60 hover:text-white transition whitespace-nowrap" data-tab="earnings">
                EARNINGS ANALYSIS
            </button>
            <button class="tab-button py-3 px-2 font-bold text-xs tracking-tight text-white/60 hover:text-white transition whitespace-nowrap" data-tab="activity">
                ACTIVITY LOG
            </button>
        </div>
    </div>

    <!-- Tab Content: Asset Management -->
    <div id="assets-tab" class="tab-content active fade-in-section">
        <!-- Filter -->
        <div class="flex items-center space-x-4 mb-6">
            <button class="filter-btn active bg-cyan-accent/20 text-cyan-accent px-4 py-2 btn-sharp text-xs font-bold tracking-tight transition" data-filter="all">
                전체
            </button>
            <button class="filter-btn bg-dark-card text-white/60 px-4 py-2 btn-sharp text-xs font-bold tracking-tight hover:text-white transition" data-filter="pending">
                검증 대기
            </button>
            <button class="filter-btn bg-dark-card text-white/60 px-4 py-2 btn-sharp text-xs font-bold tracking-tight hover:text-white transition" data-filter="approved">
                판매 중
            </button>
        </div>

        <!-- Asset List -->
        <div id="assetList" class="grid md:grid-cols-3 gap-6">
            <div class="text-center py-12 col-span-3 text-white/40 text-sm">
                블록이 없습니다. 첫 번째 블록을 생성해보세요!
            </div>
        </div>
    </div>

    <!-- Tab Content: Earnings Analysis -->
    <div id="earnings-tab" class="tab-content">
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Left: Creator Profile -->
            <div class="lg:col-span-1">
                <div class="bg-dark-card border border-minimal p-8">
                    <h3 class="text-xl font-black tracking-tight mb-6 text-cyan-accent">CREATOR PROFILE</h3>
                    
                    <div class="space-y-6">
                        <div>
                            <div class="text-white/60 text-xs tracking-tight mb-1">가입일</div>
                            <div id="joinDate" class="font-bold tracking-tight">-</div>
                        </div>
                        <div>
                            <div class="text-white/60 text-xs tracking-tight mb-1">활동일수</div>
                            <div id="activeDays" class="font-bold tracking-tight">-</div>
                        </div>
                        <div>
                            <div class="text-white/60 text-xs tracking-tight mb-1">베스트 블록</div>
                            <div id="bestBlock" class="font-bold tracking-tight">-</div>
                        </div>
                        <div>
                            <div class="text-white/60 text-xs tracking-tight mb-1">크리에이터 레벨</div>
                            <div id="creatorLevel" class="text-cyan-accent font-black text-xl tracking-tighter">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Charts -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Revenue Chart -->
                <div class="bg-dark-card border border-minimal p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-black tracking-tight text-cyan-accent">REVENUE TREND</h3>
                        <div class="flex space-x-2">
                            <button class="period-btn active bg-cyan-accent/20 text-cyan-accent px-3 py-1 btn-sharp text-xs font-bold tracking-tight" data-period="daily">일간</button>
                            <button class="period-btn bg-dark-card text-white/60 px-3 py-1 btn-sharp text-xs font-bold tracking-tight hover:text-white" data-period="weekly">주간</button>
                            <button class="period-btn bg-dark-card text-white/60 px-3 py-1 btn-sharp text-xs font-bold tracking-tight hover:text-white" data-period="monthly">월간</button>
                        </div>
                    </div>
                    <div style="height: 250px;">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <!-- Top Blocks -->
                <div class="bg-dark-card border border-minimal p-8">
                    <h3 class="text-xl font-black tracking-tight mb-6 text-cyan-accent">TOP 10 BLOCKS</h3>
                    <div id="topBlocksList" class="space-y-3">
                        <div class="text-white/40 text-sm">데이터가 없습니다</div>
                    </div>
                </div>

                <!-- Category Chart -->
                <div class="bg-dark-card border border-minimal p-8">
                    <h3 class="text-xl font-black tracking-tight mb-6 text-cyan-accent">CATEGORY RATIO</h3>
                    <div style="height: 250px;">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Content: Activity Log -->
    <div id="activity-tab" class="tab-content">
        <div class="grid md:grid-cols-2 gap-8">
            <!-- Recent Uploads -->
            <div class="bg-dark-card border border-minimal p-8">
                <h3 class="text-xl font-black tracking-tight mb-6 text-cyan-accent">RECENT UPLOADS</h3>
                <div id="recentUploads" class="space-y-4">
                    <div class="text-white/40 text-sm">최근 업로드가 없습니다</div>
                </div>
            </div>

            <!-- Recent Sales -->
            <div class="bg-dark-card border border-minimal p-8">
                <h3 class="text-xl font-black tracking-tight mb-6 text-cyan-accent">RECENT SALES</h3>
                <div id="recentSales" class="space-y-4">
                    <div class="text-white/40 text-sm">최근 판매가 없습니다</div>
                </div>
            </div>

            <!-- Feedback Summary -->
            <div class="bg-dark-card border border-minimal p-8 md:col-span-2">
                <h3 class="text-xl font-black tracking-tight mb-6 text-cyan-accent">FEEDBACK SUMMARY</h3>
                <div class="grid grid-cols-3 gap-6">
                    <div>
                        <div class="text-white/60 text-xs tracking-tight mb-2">리뷰 수</div>
                        <div id="reviewCount" class="text-2xl font-black text-cyan-accent tracking-tighter">0</div>
                    </div>
                    <div>
                        <div class="text-white/60 text-xs tracking-tight mb-2">평균 평점</div>
                        <div id="avgReviewRating" class="text-2xl font-black text-cyan-accent tracking-tighter">0.0</div>
                    </div>
                    <div>
                        <div class="text-white/60 text-xs tracking-tight mb-2">재구매율</div>
                        <div id="repurchaseRate" class="text-2xl font-black text-cyan-accent tracking-tighter">0%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<footer class="border-t border-minimal py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col md:flex-row justify-between items-center">
            <div class="mb-6 md:mb-0">
                <img src="images/trex-logo-full.png" alt="Trex.so - Travel. Assemble. Play." class="h-12 md:h-14 w-auto mb-3">
                <p class="text-white/40 text-sm tracking-tight">© 2026 Trex.so. All rights reserved.</p>
            </div>
            
            <div class="flex space-x-8">
                <a href="#" class="text-white/60 hover:text-cyan-accent transition text-sm tracking-tight">이용약관</a>
                <a href="#" class="text-white/60 hover:text-cyan-accent transition text-sm tracking-tight">개인정보처리방침</a>
                <a href="#" class="text-white/60 hover:text-cyan-accent transition text-sm tracking-tight">FAQ</a>
                <a href="#" class="text-white/60 hover:text-cyan-accent transition text-sm tracking-tight">문의</a>
            </div>
        </div>
    </div>
</footer>

<script src="js/auth.js"></script>
<script>
// Auth check
if (!isLoggedIn()) {
    alert('로그인이 필요한 페이지입니다.');
    window.location.href = 'login.html';
}

// Render user in header
window.addEventListener('DOMContentLoaded', () => {
    renderUserInHeader('authButtons');
    renderUserInHeader('authButtonsMobile');
});

// Mobile menu
document.getElementById('mobileMenuBtn').addEventListener('click', () => {
    document.getElementById('mobileMenu').classList.toggle('hidden');
});

// Tab switching
const tabButtons = document.querySelectorAll('.tab-button');
const tabContents = document.querySelectorAll('.tab-content');

tabButtons.forEach(button => {
    button.addEventListener('click', () => {
        const tabName = button.dataset.tab;
        
        tabButtons.forEach(btn => {
            btn.classList.remove('active', 'text-cyan-accent');
            btn.classList.add('text-white/60');
        });
        button.classList.add('active', 'text-cyan-accent');
        button.classList.remove('text-white/60');
        
        tabContents.forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`${tabName}-tab`).classList.add('active');
    });
});

// Fade-in observer
const fadeInObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('visible');
        }
    });
}, { threshold: 0.1 });

document.querySelectorAll('.fade-in-section').forEach(el => {
    fadeInObserver.observe(el);
});

// Load creator data
const currentUser = getCurrentUser();
if (currentUser) {
    loadCreatorData(currentUser.nickname);
}

async function loadCreatorData(creatorName) {
    try {
        const response = await fetch(`tables/blocks?search=${encodeURIComponent(creatorName)}`);
        const result = await response.json();
        
        if (result.data && result.data.length > 0) {
            const blocks = result.data;
            
            // Quick Stats
            document.getElementById('totalBlocks').textContent = blocks.length;
            
            const totalRevenue = blocks.reduce((sum, block) => {
                return sum + (block.price * (block.purchase_count || 0));
            }, 0);
            document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
            
            const totalSales = blocks.reduce((sum, block) => sum + (block.purchase_count || 0), 0);
            document.getElementById('totalSales').textContent = totalSales;
            
            const avgRating = blocks.reduce((sum, block) => sum + (block.rating || 0), 0) / blocks.length;
            document.getElementById('avgRating').textContent = avgRating.toFixed(1);
            
            // Render blocks
            renderBlocks(blocks);
            
            // Creator Profile
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (user) {
                document.getElementById('joinDate').textContent = new Date(user.created_at).toLocaleDateString('ko-KR');
                
                const daysSinceJoin = Math.floor((Date.now() - new Date(user.created_at)) / (1000 * 60 * 60 * 24));
                document.getElementById('activeDays').textContent = `${daysSinceJoin}일`;
                
                const bestBlock = blocks.reduce((best, block) => {
                    const revenue = block.price * (block.purchase_count || 0);
                    const bestRevenue = best.price * (best.purchase_count || 0);
                    return revenue > bestRevenue ? block : best;
                }, blocks[0]);
                document.getElementById('bestBlock').textContent = bestBlock.title || '-';
                
                const level = blocks.length < 5 ? '신입' : blocks.length < 15 ? '일반' : blocks.length < 30 ? '베테랑' : blocks.length < 50 ? '마스터' : '레전드';
                document.getElementById('creatorLevel').textContent = level;
            }
            
            // Charts
            initRevenueChart(blocks);
            initCategoryChart(blocks);
            renderTopBlocks(blocks);
            renderActivityLog(blocks);
        }
    } catch (error) {
        console.error('Failed to load creator data:', error);
    }
}

function renderBlocks(blocks) {
    const assetList = document.getElementById('assetList');
    assetList.innerHTML = '';
    
    blocks.forEach(block => {
        const card = document.createElement('div');
        card.className = 'asset-card bg-dark-card border border-minimal hover:border-cyan-accent transition cursor-pointer';
        card.innerHTML = `
            <img src="${block.image_url || 'https://via.placeholder.com/400x200'}" alt="${block.title}" class="w-full h-40 object-cover">
            <div class="p-6">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-cyan-accent font-bold text-lg tracking-tight">$${block.price}</span>
                    <span class="text-xs px-2 py-1 btn-sharp ${block.status === 'approved' ? 'bg-cyan-accent/20 text-cyan-accent' : 'bg-yellow-500/20 text-yellow-500'}">
                        ${block.status === 'approved' ? '판매중' : '검증대기'}
                    </span>
                </div>
                <h4 class="font-bold text-sm mb-2 tracking-tight truncate">${block.title}</h4>
                <div class="flex justify-between text-xs text-white/60 tracking-tight">
                    <span>⭐ ${block.rating || 0}</span>
                    <span>${block.purchase_count || 0}건</span>
                </div>
            </div>
        `;
        assetList.appendChild(card);
    });
}

function initRevenueChart(blocks) {
    const ctx = document.getElementById('revenueChart').getContext('2d');
    
    // Simulate 7 days data
    const labels = ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'];
    const data = [10, 25, 15, 40, 30, 45, 50];
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Revenue ($)',
                data: data,
                borderColor: '#00AEF0',
                backgroundColor: 'rgba(0, 174, 240, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(255,255,255,0.1)' },
                    ticks: { color: 'rgba(255,255,255,0.6)' }
                },
                x: {
                    grid: { color: 'rgba(255,255,255,0.1)' },
                    ticks: { color: 'rgba(255,255,255,0.6)' }
                }
            }
        }
    });
}

function initCategoryChart(blocks) {
    const ctx = document.getElementById('categoryChart').getContext('2d');
    
    const categories = {};
    blocks.forEach(block => {
        categories[block.category] = (categories[block.category] || 0) + 1;
    });
    
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: Object.keys(categories),
            datasets: [{
                data: Object.values(categories),
                backgroundColor: [
                    '#00AEF0',
                    'rgba(0, 174, 240, 0.7)',
                    'rgba(0, 174, 240, 0.5)',
                    'rgba(0, 174, 240, 0.3)',
                    'rgba(0, 174, 240, 0.2)'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                    labels: { color: 'rgba(255,255,255,0.7)' }
                }
            }
        }
    });
}

function renderTopBlocks(blocks) {
    const topBlocksList = document.getElementById('topBlocksList');
    const sorted = blocks
        .sort((a, b) => (b.price * b.purchase_count) - (a.price * a.purchase_count))
        .slice(0, 10);
    
    if (sorted.length === 0) {
        topBlocksList.innerHTML = '<div class="text-white/40 text-sm">데이터가 없습니다</div>';
        return;
    }
    
    topBlocksList.innerHTML = sorted.map((block, index) => `
        <div class="flex justify-between items-center py-3 border-b border-minimal">
            <div class="flex items-center space-x-3">
                <span class="text-cyan-accent font-black text-lg">#${index + 1}</span>
                <span class="font-bold text-sm tracking-tight truncate">${block.title}</span>
            </div>
            <span class="text-cyan-accent font-bold tracking-tight">$${(block.price * block.purchase_count).toFixed(2)}</span>
        </div>
    `).join('');
}

function renderActivityLog(blocks) {
    // Recent uploads
    const recent = blocks.slice(0, 10);
    const uploadsDiv = document.getElementById('recentUploads');
    
    if (recent.length === 0) {
        uploadsDiv.innerHTML = '<div class="text-white/40 text-sm">최근 업로드가 없습니다</div>';
    } else {
        uploadsDiv.innerHTML = recent.map(block => `
            <div class="flex items-center space-x-4 p-3 bg-black/30 border border-minimal hover:border-cyan-accent transition">
                <img src="${block.image_url || 'https://via.placeholder.com/60'}" alt="${block.title}" class="w-16 h-16 object-cover">
                <div class="flex-1">
                    <div class="font-bold text-sm tracking-tight truncate">${block.title}</div>
                    <div class="text-xs text-white/60 tracking-tight">${new Date(block.created_at).toLocaleDateString('ko-KR')}</div>
                </div>
            </div>
        `).join('');
    }
    
    // Feedback summary
    document.getElementById('reviewCount').textContent = blocks.length * 5;
    document.getElementById('avgReviewRating').textContent = '4.7';
    document.getElementById('repurchaseRate').textContent = '35%';
}

// Filter buttons
document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => {
            b.classList.remove('active', 'bg-cyan-accent/20', 'text-cyan-accent');
            b.classList.add('bg-dark-card', 'text-white/60');
        });
        btn.classList.add('active', 'bg-cyan-accent/20', 'text-cyan-accent');
        btn.classList.remove('bg-dark-card', 'text-white/60');
    });
});

// Period buttons
document.querySelectorAll('.period-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.period-btn').forEach(b => {
            b.classList.remove('active', 'bg-cyan-accent/20', 'text-cyan-accent');
            b.classList.add('bg-dark-card', 'text-white/60');
        });
        btn.classList.add('active', 'bg-cyan-accent/20', 'text-cyan-accent');
        btn.classList.remove('bg-dark-card', 'text-white/60');
    });
});
</script>

</body>
</html>
