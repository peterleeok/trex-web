<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creator Studio | Trex.so - 크리에이터 레코드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
        }
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .asset-card {
            transition: all 0.3s ease;
        }
        .asset-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.1);
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #c4c4c4;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a0a0a0;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm fixed w-full top-0 z-50 backdrop-blur-lg bg-white/90">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="index.html" class="text-2xl font-bold text-blue-600">
                        <i class="fas fa-cube mr-2"></i>Trex.so
                    </a>
                </div>
                <div class="hidden md:flex space-x-6">
                    <a href="index.html" class="text-gray-600 hover:text-blue-600">홈</a>
                    <a href="upload.html" class="text-gray-600 hover:text-blue-600">경험 업로드</a>
                    <a href="market.html" class="text-gray-600 hover:text-blue-600">블록 마켓</a>
                    <a href="creator-studio.html" class="text-blue-600 font-semibold">크리에이터 스튜디오</a>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="authButtons" class="hidden md:block"></div>
                    <button id="mobileMenuBtn" class="md:hidden text-gray-600 hover:text-blue-600 focus:outline-none">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobileMenu" class="hidden md:hidden bg-white border-t border-gray-200">
            <div class="px-4 py-4 space-y-3">
                <a href="index.html" class="block text-gray-600 hover:text-blue-600 font-medium py-2">홈</a>
                <a href="upload.html" class="block text-gray-600 hover:text-blue-600 font-medium py-2">경험 업로드</a>
                <a href="market.html" class="block text-gray-600 hover:text-blue-600 font-medium py-2">블록 마켓</a>
                <a href="creator-studio.html" class="block text-blue-600 font-semibold py-2">크리에이터 스튜디오</a>
                <div id="authButtonsMobile"></div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-4 max-w-7xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                <div class="mb-4 md:mb-0">
                    <h1 class="text-3xl md:text-4xl font-bold gradient-text mb-2">Creator Record</h1>
                    <p class="text-gray-600 text-base md:text-lg">크리에이터 레코드 - 당신의 디지털 자산을 한눈에</p>
                </div>
                <a href="upload.html" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition text-center">
                    <i class="fas fa-plus mr-2"></i>새 블록 생성
                </a>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-md p-4 md:p-6 border-l-4 border-blue-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm mb-1">총 블록 수</p>
                        <p class="text-2xl md:text-3xl font-bold text-gray-800" id="totalBlocks">0</p>
                    </div>
                    <div class="bg-blue-100 p-3 md:p-4 rounded-full">
                        <i class="fas fa-cube text-blue-600 text-lg md:text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-4 md:p-6 border-l-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm mb-1">총 수익</p>
                        <p class="text-2xl md:text-3xl font-bold text-gray-800" id="totalRevenue">$0</p>
                    </div>
                    <div class="bg-green-100 p-3 md:p-4 rounded-full">
                        <i class="fas fa-dollar-sign text-green-600 text-lg md:text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-4 md:p-6 border-l-4 border-purple-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm mb-1">총 판매 수</p>
                        <p class="text-2xl md:text-3xl font-bold text-gray-800" id="totalSales">0</p>
                    </div>
                    <div class="bg-purple-100 p-3 md:p-4 rounded-full">
                        <i class="fas fa-shopping-cart text-purple-600 text-lg md:text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-4 md:p-6 border-l-4 border-yellow-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm mb-1">평균 평점</p>
                        <p class="text-2xl md:text-3xl font-bold text-gray-800" id="avgRating">0.0</p>
                    </div>
                    <div class="bg-yellow-100 p-3 md:p-4 rounded-full">
                        <i class="fas fa-star text-yellow-600 text-lg md:text-2xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- 크리에이터 프로필 카드 -->
        <div class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-xl shadow-lg p-6 md:p-8 mb-8 text-white">
            <div class="flex flex-col md:flex-row items-center md:items-start md:space-x-6">
                <div class="mb-4 md:mb-0">
                    <div class="w-24 h-24 md:w-32 md:h-32 rounded-full bg-white/20 backdrop-blur flex items-center justify-center text-4xl md:text-5xl font-bold border-4 border-white/30" id="creatorAvatar">U</div>
                </div>
                
                <div class="flex-1 text-center md:text-left">
                    <h2 class="text-2xl md:text-3xl font-bold mb-2" id="creatorName">크리에이터</h2>
                    <p class="text-white/80 mb-4" id="creatorEmail">email@trex.so</p>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-white/10 backdrop-blur rounded-lg p-3">
                            <p class="text-white/70 text-xs mb-1">가입일</p>
                            <p class="font-semibold text-sm" id="joinDate">2026-01-01</p>
                        </div>
                        <div class="bg-white/10 backdrop-blur rounded-lg p-3">
                            <p class="text-white/70 text-xs mb-1">활동 일수</p>
                            <p class="font-semibold text-sm"><span id="activeDays">0</span>일</p>
                        </div>
                        <div class="bg-white/10 backdrop-blur rounded-lg p-3">
                            <p class="text-white/70 text-xs mb-1">베스트 블록</p>
                            <p class="font-semibold text-sm" id="bestBlock">-</p>
                        </div>
                        <div class="bg-white/10 backdrop-blur rounded-lg p-3">
                            <p class="text-white/70 text-xs mb-1">크리에이터 레벨</p>
                            <p class="font-semibold text-sm" id="creatorLevel"><i class="fas fa-star mr-1"></i><span id="levelText">입문</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 탭 네비게이션 -->
        <div class="bg-white rounded-xl shadow-lg mb-8">
            <div class="border-b border-gray-200">
                <div class="flex flex-wrap">
                    <button onclick="switchTab('assets')" class="tab-btn px-4 md:px-6 py-3 md:py-4 font-semibold text-sm md:text-base border-b-2 border-blue-600 text-blue-600" data-tab="assets">
                        <i class="fas fa-database mr-2"></i>자산 관리
                    </button>
                    <button onclick="switchTab('revenue')" class="tab-btn px-4 md:px-6 py-3 md:py-4 font-semibold text-sm md:text-base border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="revenue">
                        <i class="fas fa-chart-line mr-2"></i>수익 분석
                    </button>
                    <button onclick="switchTab('activity')" class="tab-btn px-4 md:px-6 py-3 md:py-4 font-semibold text-sm md:text-base border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="activity">
                        <i class="fas fa-history mr-2"></i>활동 기록
                    </button>
                </div>
            </div>

            <div class="p-4 md:p-6">
                <!-- 자산 관리 탭 -->
                <div id="assetsTab" class="tab-content active">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button onclick="filterAssets('all')" class="px-4 py-2 rounded-lg bg-blue-100 text-blue-600 font-semibold filter-btn text-sm active" data-filter="all">전체</button>
                        <button onclick="filterAssets('pending')" class="px-4 py-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 filter-btn text-sm" data-filter="pending">검증 대기</button>
                        <button onclick="filterAssets('approved')" class="px-4 py-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 filter-btn text-sm" data-filter="approved">판매 중</button>
                    </div>
                    <div id="assetList" class="space-y-4 max-h-[600px] overflow-y-auto">
                        <div class="text-center py-12 text-gray-400">
                            <i class="fas fa-box-open text-6xl mb-4"></i>
                            <p class="text-lg">아직 생성된 블록이 없습니다</p>
                            <a href="upload.html" class="text-blue-600 hover:underline mt-2 inline-block">첫 블록 만들기 →</a>
                        </div>
                    </div>
                </div>

                <!-- 수익 분석 탭 -->
                <div id="revenueTab" class="tab-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-gradient-to-br from-green-50 to-teal-50 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4"><i class="fas fa-calendar-alt mr-2 text-green-600"></i>기간별 수익</h3>
                            <div class="flex space-x-2 mb-4">
                                <button onclick="changePeriod('daily')" class="period-btn px-4 py-2 rounded-lg bg-green-600 text-white text-sm font-semibold" data-period="daily">일별</button>
                                <button onclick="changePeriod('weekly')" class="period-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-600 text-sm font-semibold" data-period="weekly">주별</button>
                                <button onclick="changePeriod('monthly')" class="period-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-600 text-sm font-semibold" data-period="monthly">월별</button>
                            </div>
                            <div style="height: 250px;">
                                <canvas id="periodChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4"><i class="fas fa-pie-chart mr-2 text-purple-600"></i>카테고리별 판매</h3>
                            <div style="height: 250px;">
                                <canvas id="categoryChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white border border-gray-200 rounded-xl p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4"><i class="fas fa-trophy mr-2 text-yellow-600"></i>블록별 수익 순위 TOP 10</h3>
                        <div id="topBlocksList" class="space-y-3"></div>
                    </div>
                </div>

                <!-- 활동 기록 탭 -->
                <div id="activityTab" class="tab-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4"><i class="fas fa-clock mr-2 text-blue-600"></i>최근 업로드 (최근 10개)</h3>
                            <div id="recentUploadsList" class="space-y-3 max-h-[400px] overflow-y-auto"></div>
                        </div>
                        
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4"><i class="fas fa-shopping-bag mr-2 text-green-600"></i>최근 판매 내역 (최근 20건)</h3>
                            <div id="recentSalesList" class="space-y-3 max-h-[400px] overflow-y-auto"></div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-yellow-50 to-orange-50 border border-yellow-200 rounded-xl p-6 mt-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4"><i class="fas fa-comments mr-2 text-yellow-600"></i>피드백 & 리뷰 현황</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white rounded-lg p-4 text-center">
                                <p class="text-gray-600 text-sm mb-2">총 리뷰 수</p>
                                <p class="text-3xl font-bold text-gray-800" id="totalReviews">0</p>
                            </div>
                            <div class="bg-white rounded-lg p-4 text-center">
                                <p class="text-gray-600 text-sm mb-2">평균 평점</p>
                                <p class="text-3xl font-bold text-yellow-600" id="avgReviewRating">0.0</p>
                            </div>
                            <div class="bg-white rounded-lg p-4 text-center">
                                <p class="text-gray-600 text-sm mb-2">재구매율</p>
                                <p class="text-3xl font-bold text-green-600" id="repurchaseRate">0%</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="js/auth.js"></script>
    <script>
        let myBlocks = [];
        let currentFilter = 'all';
        let currentPeriod = 'daily';
        let periodChart, categoryChart;

        // Mobile Menu Toggle
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
            const icon = mobileMenuBtn.querySelector('i');
            icon.classList.toggle('fa-bars');
            icon.classList.toggle('fa-times');
        });

        document.addEventListener('DOMContentLoaded', async () => {
            renderUserInHeader('authButtons');
            renderUserInHeader('authButtonsMobile');
            
            const user = getCurrentUser();
            if (!user) {
                alert('로그인이 필요합니다.');
                window.location.href = 'login.html';
                return;
            }

            loadCreatorProfile(user);
            await loadMyAssets();
            initCharts();
        });

        // 크리에이터 프로필 로드
        function loadCreatorProfile(user) {
            document.getElementById('creatorAvatar').textContent = (user.nickname || 'U').charAt(0).toUpperCase();
            document.getElementById('creatorName').textContent = user.nickname || '크리에이터';
            document.getElementById('creatorEmail').textContent = user.email;
            
            const joinDateObj = new Date(user.created_at);
            document.getElementById('joinDate').textContent = joinDateObj.toLocaleDateString('ko-KR', {year: 'numeric', month: '2-digit', day: '2-digit'}).replace(/\. /g, '-').replace('.', '');
            
            const activeDays = Math.floor((Date.now() - joinDateObj.getTime()) / (1000 * 60 * 60 * 24));
            document.getElementById('activeDays').textContent = activeDays;
            
            // 레벨 계산
            const level = myBlocks.length < 5 ? '입문' : myBlocks.length < 20 ? '중급' : myBlocks.length < 50 ? '고급' : '마스터';
            document.getElementById('levelText').textContent = level;
        }

        // 자산 로드
        async function loadMyAssets() {
            try {
                const user = getCurrentUser();
                const response = await fetch(`tables/blocks?limit=100`);
                const data = await response.json();
                
                myBlocks = data.data.filter(block => 
                    block.creator_name === user.nickname || 
                    block.creator_name === user.email
                );

                updateQuickStats();
                updateBestBlock();
                renderAssetList();
                updateRevenueAnalysis();
                updateActivityRecords();
            } catch (error) {
                console.error('Failed to load assets:', error);
            }
        }

        function updateQuickStats() {
            const totalBlocks = myBlocks.length;
            const totalSales = myBlocks.reduce((sum, b) => sum + (b.purchase_count || 0), 0);
            const totalRevenue = myBlocks.reduce((sum, b) => sum + ((b.purchase_count || 0) * (b.price || 0)), 0);
            const avgRating = myBlocks.length > 0 ? (myBlocks.reduce((sum, b) => sum + (b.rating || 0), 0) / myBlocks.length).toFixed(1) : '0.0';

            document.getElementById('totalBlocks').textContent = totalBlocks;
            document.getElementById('totalSales').textContent = totalSales;
            document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
            document.getElementById('avgRating').textContent = avgRating;
        }

        function updateBestBlock() {
            if (myBlocks.length === 0) {
                document.getElementById('bestBlock').textContent = '-';
                return;
            }
            const best = myBlocks.reduce((prev, current) => 
                ((prev.purchase_count || 0) * (prev.price || 0)) > ((current.purchase_count || 0) * (current.price || 0)) ? prev : current
            );
            document.getElementById('bestBlock').textContent = best.title.substring(0, 10) + '...';
        }

        function filterAssets(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.filter === filter) {
                    btn.classList.add('bg-blue-100', 'text-blue-600', 'active');
                    btn.classList.remove('bg-gray-100', 'text-gray-600');
                } else {
                    btn.classList.remove('bg-blue-100', 'text-blue-600', 'active');
                    btn.classList.add('bg-gray-100', 'text-gray-600');
                }
            });
            renderAssetList();
        }

        function renderAssetList() {
            const assetList = document.getElementById('assetList');
            let filteredBlocks = myBlocks;
            if (currentFilter === 'pending') filteredBlocks = myBlocks.filter(b => b.status === 'pending');
            else if (currentFilter === 'approved') filteredBlocks = myBlocks.filter(b => b.status === 'approved');

            if (filteredBlocks.length === 0) {
                assetList.innerHTML = `<div class="text-center py-12 text-gray-400"><i class="fas fa-box-open text-6xl mb-4"></i><p class="text-lg">블록이 없습니다</p><a href="upload.html" class="text-blue-600 hover:underline mt-2 inline-block">첫 블록 만들기 →</a></div>`;
                return;
            }

            assetList.innerHTML = filteredBlocks.map(block => {
                const statusConfig = {
                    'pending': {text: '검증 대기', bgClass: 'bg-yellow-100 text-yellow-700'},
                    'approved': {text: '판매 중', bgClass: 'bg-green-100 text-green-700'}
                };
                const status = statusConfig[block.status] || statusConfig['approved'];
                const earnings = ((block.purchase_count || 0) * (block.price || 0)).toFixed(2);

                return `
                    <div class="asset-card bg-white border rounded-lg p-4 flex flex-col md:flex-row md:items-center space-y-3 md:space-y-0 md:space-x-4">
                        <img src="${block.image_url || 'https://via.placeholder.com/100'}" alt="${block.title}" class="w-full md:w-24 h-32 md:h-24 object-cover rounded-lg">
                        <div class="flex-1">
                            <div class="flex flex-col md:flex-row md:items-start md:justify-between mb-2">
                                <div class="mb-2 md:mb-0">
                                    <h3 class="font-semibold text-gray-800 text-lg">${block.title}</h3>
                                    <p class="text-sm text-gray-600">${(block.description || '').substring(0, 60)}...</p>
                                </div>
                                <span class="${status.bgClass} px-3 py-1 rounded-full text-xs font-semibold">${status.text}</span>
                            </div>
                            <div class="flex flex-wrap items-center gap-4 text-sm">
                                <span class="text-blue-600 font-semibold">$${block.price}</span>
                                <span class="text-gray-600"><i class="fas fa-shopping-cart mr-1"></i>${block.purchase_count || 0}건</span>
                                <span class="text-gray-600"><i class="fas fa-star text-yellow-500 mr-1"></i>${block.rating || 0}</span>
                                <span class="text-green-600 font-semibold md:ml-auto">수익: $${earnings}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateRevenueAnalysis() {
            // 블록별 수익 순위
            const sortedBlocks = [...myBlocks].sort((a, b) => 
                ((b.purchase_count || 0) * (b.price || 0)) - ((a.purchase_count || 0) * (a.price || 0))
            ).slice(0, 10);

            const topBlocksList = document.getElementById('topBlocksList');
            if (sortedBlocks.length === 0) {
                topBlocksList.innerHTML = '<p class="text-gray-400 text-center py-8">아직 판매 데이터가 없습니다</p>';
            } else {
                topBlocksList.innerHTML = sortedBlocks.map((block, index) => {
                    const earnings = ((block.purchase_count || 0) * (block.price || 0)).toFixed(2);
                    const medalColors = ['text-yellow-500', 'text-gray-400', 'text-orange-600'];
                    const medalColor = index < 3 ? medalColors[index] : 'text-gray-300';
                    return `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <div class="flex items-center space-x-3">
                                <span class="${medalColor} font-bold text-lg w-6">${index + 1}</span>
                                <div>
                                    <p class="font-semibold text-gray-800">${block.title}</p>
                                    <p class="text-xs text-gray-500">${block.purchase_count || 0}건 판매 • $${block.price}</p>
                                </div>
                            </div>
                            <span class="text-green-600 font-bold">$${earnings}</span>
                        </div>
                    `;
                }).join('');
            }

            updatePeriodChart();
            updateCategoryChart();
        }

        function updateActivityRecords() {
            // 최근 업로드
            const recentUploads = [...myBlocks].sort((a, b) => (b.created_at || 0) - (a.created_at || 0)).slice(0, 10);
            const recentUploadsList = document.getElementById('recentUploadsList');
            
            if (recentUploads.length === 0) {
                recentUploadsList.innerHTML = '<p class="text-gray-400 text-center py-8">업로드 기록이 없습니다</p>';
            } else {
                recentUploadsList.innerHTML = recentUploads.map(block => {
                    const date = new Date(block.created_at || Date.now()).toLocaleDateString('ko-KR');
                    return `
                        <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                            <img src="${block.image_url || 'https://via.placeholder.com/50'}" alt="${block.title}" class="w-12 h-12 rounded object-cover">
                            <div class="flex-1">
                                <p class="font-semibold text-sm text-gray-800">${block.title}</p>
                                <p class="text-xs text-gray-500">${date}</p>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // 최근 판매 (시뮬레이션)
            const recentSalesList = document.getElementById('recentSalesList');
            const salesData = myBlocks.filter(b => (b.purchase_count || 0) > 0).flatMap(block => {
                return Array(block.purchase_count || 0).fill(null).map(() => ({
                    title: block.title,
                    price: block.price,
                    date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000)
                }));
            }).sort((a, b) => b.date - a.date).slice(0, 20);

            if (salesData.length === 0) {
                recentSalesList.innerHTML = '<p class="text-gray-400 text-center py-8">판매 기록이 없습니다</p>';
            } else {
                recentSalesList.innerHTML = salesData.map(sale => {
                    const date = sale.date.toLocaleDateString('ko-KR');
                    return `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <p class="font-semibold text-sm text-gray-800">${sale.title}</p>
                                <p class="text-xs text-gray-500">${date}</p>
                            </div>
                            <span class="text-green-600 font-semibold">+$${sale.price}</span>
                        </div>
                    `;
                }).join('');
            }

            // 피드백 현황 (시뮬레이션)
            const totalReviews = myBlocks.reduce((sum, b) => sum + (b.purchase_count || 0), 0);
            const avgReviewRating = myBlocks.length > 0 ? (myBlocks.reduce((sum, b) => sum + (b.rating || 0), 0) / myBlocks.length).toFixed(1) : '0.0';
            const repurchaseRate = totalReviews > 0 ? Math.min(Math.round((totalReviews / myBlocks.length) * 100), 100) : 0;

            document.getElementById('totalReviews').textContent = totalReviews;
            document.getElementById('avgReviewRating').textContent = avgReviewRating;
            document.getElementById('repurchaseRate').textContent = repurchaseRate + '%';
        }

        function initCharts() {
            // Period Chart
            const periodCtx = document.getElementById('periodChart').getContext('2d');
            periodChart = new Chart(periodCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '수익 ($)',
                        data: [],
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {legend: {display: false}}
                }
            });

            // Category Chart
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            categoryChart = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: ['#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981', '#6366f1']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {legend: {position: 'bottom'}}
                }
            });
        }

        function updatePeriodChart() {
            let labels, data;
            if (currentPeriod === 'daily') {
                labels = ['월', '화', '수', '목', '금', '토', '일'];
                data = [12, 19, 15, 22, 18, 25, 20];
            } else if (currentPeriod === 'weekly') {
                labels = ['1주', '2주', '3주', '4주'];
                data = [85, 102, 95, 110];
            } else {
                labels = ['1월', '2월', '3월', '4월', '5월', '6월'];
                data = [250, 310, 285, 350, 390, 420];
            }

            periodChart.data.labels = labels;
            periodChart.data.datasets[0].data = data;
            periodChart.update();
        }

        function updateCategoryChart() {
            const categoryData = {};
            myBlocks.forEach(block => {
                const cat = block.category || '기타';
                const sales = (block.purchase_count || 0) * (block.price || 0);
                categoryData[cat] = (categoryData[cat] || 0) + sales;
            });

            const labels = Object.keys(categoryData);
            const data = Object.values(categoryData);

            categoryChart.data.labels = labels;
            categoryChart.data.datasets[0].data = data;
            categoryChart.update();
        }

        function changePeriod(period) {
            currentPeriod = period;
            document.querySelectorAll('.period-btn').forEach(btn => {
                if (btn.dataset.period === period) {
                    btn.classList.add('bg-green-600', 'text-white');
                    btn.classList.remove('bg-gray-200', 'text-gray-600');
                } else {
                    btn.classList.remove('bg-green-600', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-600');
                }
            });
            updatePeriodChart();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.dataset.tab === tab) {
                    btn.classList.add('border-blue-600', 'text-blue-600');
                    btn.classList.remove('border-transparent', 'text-gray-500');
                } else {
                    btn.classList.remove('border-blue-600', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                }
            });

            document.getElementById(tab + 'Tab').classList.add('active');
        }
    </script>
</body>
</html>
