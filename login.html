<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¡œê·¸ì¸ | Trex.so</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700&display=swap');
body { font-family: 'Pretendard', sans-serif; }
.gradient-text {
background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
}
</style>
</head>
<body class="bg-gray-50 text-gray-800">

<!-- Navigation -->
<nav class="fixed w-full bg-white/90 backdrop-blur-md z-50 border-b border-gray-100 shadow-sm">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex justify-between items-center h-16">
<div class="flex items-center">
<a href="index.html" class="text-2xl font-bold text-blue-600"><i class="fa-solid fa-cube mr-2"></i>Trex.so</a>
</div>
<div class="hidden md:flex space-x-8">
<a href="index.html" class="text-gray-600 hover:text-blue-600 font-medium">í™ˆ</a>
<a href="market.html" class="text-gray-600 hover:text-blue-600 font-medium">ë¸”ë¡ ë§ˆì¼“</a>
</div>
</div>
</div>
</nav>

<!-- Login Section -->
<section class="min-h-screen flex items-center justify-center py-24 px-4">
<div class="max-w-md w-full">
<!-- í—¤ë” ì•ˆë‚´ -->
<div class="text-center mb-8">
<h1 class="text-4xl font-bold mb-3">
<span class="gradient-text">Trex.so</span> ì‹œì‘í•˜ê¸°
</h1>
<p class="text-gray-600 text-lg">ì—¬í–‰ ê²½í—˜ì„ ìˆ˜ìµí™”í•˜ê±°ë‚˜, ë‹¤ë¥¸ ì‚¬ëŒì˜ ë¸”ë¡ìœ¼ë¡œ ì™„ë²½í•œ ì—¬í–‰ì„ ë§Œë“œì„¸ìš”</p>
</div>

<!-- íƒ­ -->
<div class="flex gap-2 mb-6">
<button class="flex-1 py-3 px-6 bg-gray-100 text-gray-600 font-bold rounded-t-xl" id="loginTab" onclick="showTab('login')">
ë¡œê·¸ì¸
</button>
<button class="flex-1 py-3 px-6 bg-white text-blue-600 font-bold rounded-t-xl border-b-2 border-blue-600" id="signupTab" onclick="showTab('signup')">
íšŒì›ê°€ì…
</button>
</div>

<!-- ë¡œê·¸ì¸ í¼ -->
<div class="bg-white rounded-2xl shadow-xl p-8 border border-gray-100" id="loginForm" style="display:none;">
<div class="text-center mb-8">
<h2 class="text-3xl font-bold text-gray-900 mb-2">í™˜ì˜í•©ë‹ˆë‹¤!</h2>
<p class="text-gray-600">Trex.soì— ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
</div>

<form onsubmit="handleLogin(event)">
<div class="mb-4">
<label class="block text-sm font-semibold text-gray-700 mb-2">ì´ë©”ì¼</label>
<input type="email" id="loginEmail" required
class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
placeholder="your@email.com">
</div>

<div class="mb-6">
<label class="block text-sm font-semibold text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
<input type="password" id="loginPassword" required
class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
</div>

<div class="flex items-center justify-between mb-6">
<label class="flex items-center">
<input type="checkbox" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
<span class="ml-2 text-sm text-gray-600">ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€</span>
</label>
<a href="#" class="text-sm text-blue-600 hover:text-blue-700">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
</div>

<button type="submit" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 transition shadow-lg">
ë¡œê·¸ì¸
</button>
</form>

<div class="mt-6 text-center">
<p class="text-sm text-gray-600">
ì•„ì§ ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? 
<a href="#" onclick="showTab('signup')" class="text-blue-600 font-semibold hover:text-blue-700">íšŒì›ê°€ì…</a>
</p>
<p class="text-sm text-gray-600 mt-2">
<a href="reset-password.html" class="text-gray-500 hover:text-blue-600">ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?</a>
</p>
</div>
</div>

<!-- íšŒì›ê°€ì… í¼ -->
<div class="bg-white rounded-2xl shadow-xl p-8 border border-gray-100" id="signupForm">
<div class="text-center mb-8">
<h2 class="text-3xl font-bold text-gray-900 mb-2">íšŒì›ê°€ì…</h2>
<p class="text-gray-600">Trex.soì—ì„œ ì—¬í–‰ ê²½í—˜ì„ ìˆ˜ìµí™”í•˜ì„¸ìš”</p>
</div>

<form onsubmit="handleSignup(event)">
<div class="mb-4">
<label class="block text-sm font-semibold text-gray-700 mb-2">ì´ë©”ì¼</label>
<input type="email" id="signupEmail" required
class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
placeholder="your@email.com">
</div>

<div class="mb-4">
<label class="block text-sm font-semibold text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
<input type="password" id="signupPassword" required minlength="6"
class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
placeholder="6ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”">
</div>

<div class="mb-4">
<label class="block text-sm font-semibold text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
<input type="password" id="signupPasswordConfirm" required
class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”">
</div>

<div class="mb-4">
<label class="block text-sm font-semibold text-gray-700 mb-2">ë‹‰ë„¤ì„</label>
<input type="text" id="signupNickname" required
class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
placeholder="ì„œìš¸ë¡œì»¬ëŸ¬ë²„">
</div>

<div class="mb-6">
<label class="block text-sm font-semibold text-gray-700 mb-2">íšŒì› ìœ í˜•</label>
<select id="signupUserType" required
class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
<option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
<option value="creator">í¬ë¦¬ì—ì´í„° (ë¸”ë¡ íŒë§¤)</option>
<option value="traveler">ì—¬í–‰ì (ë¸”ë¡ êµ¬ë§¤)</option>
<option value="both">ë‘˜ ë‹¤</option>
</select>
</div>

<div class="mb-6">
<label class="flex items-start">
<input type="checkbox" required class="w-4 h-4 mt-1 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
<span class="ml-2 text-sm text-gray-600">
<a href="#" class="text-blue-600 hover:text-blue-700">ì´ìš©ì•½ê´€</a> ë° 
<a href="#" class="text-blue-600 hover:text-blue-700">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>ì— ë™ì˜í•©ë‹ˆë‹¤
</span>
</label>
</div>

<button type="button" 
        onclick="window.open('https://docs.google.com/forms/d/e/1FAIpQLSer4dyaogTcz589XCypAN7x6PN4c5g6h_JhZaUmdD1YVJ5vTA/viewform?usp=header', '_blank')" 
        class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 transition shadow-lg">
  1ê¸° í¬ë¦¬ì—ì´í„° ì‚¬ì „ ë“±ë¡í•˜ê¸° (ì„ ì°©ìˆœ)
</button>
</form>

<div class="mt-6 text-center">
<p class="text-sm text-gray-600">
ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? 
<a href="#" onclick="showTab('login')" class="text-blue-600 font-semibold hover:text-blue-700">ë¡œê·¸ì¸</a>
</p>
</div>
</div>
</div>
</section>

<!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
<div class="fixed bottom-6 right-6 z-50 space-y-3" id="toastContainer"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Authentication System
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// íƒ­ ì „í™˜
function showTab(tab) {
  const loginForm = document.getElementById('loginForm');
  const signupForm = document.getElementById('signupForm');
  const loginTab = document.getElementById('loginTab');
  const signupTab = document.getElementById('signupTab');

  if (tab === 'login') {
    loginForm.style.display = 'block';
    signupForm.style.display = 'none';
    loginTab.classList.add('bg-white', 'text-blue-600', 'border-b-2', 'border-blue-600');
    loginTab.classList.remove('bg-gray-100', 'text-gray-600');
    signupTab.classList.remove('bg-white', 'text-blue-600', 'border-b-2', 'border-blue-600');
    signupTab.classList.add('bg-gray-100', 'text-gray-600');
  } else {
    loginForm.style.display = 'none';
    signupForm.style.display = 'block';
    signupTab.classList.add('bg-white', 'text-blue-600', 'border-b-2', 'border-blue-600');
    signupTab.classList.remove('bg-gray-100', 'text-gray-600');
    loginTab.classList.remove('bg-white', 'text-blue-600', 'border-b-2', 'border-blue-600');
    loginTab.classList.add('bg-gray-100', 'text-gray-600');
  }
}

// íšŒì›ê°€ì… ì²˜ë¦¬
async function handleSignup(event) {
  event.preventDefault();

  const email = document.getElementById('signupEmail').value;
  const password = document.getElementById('signupPassword').value;
  const passwordConfirm = document.getElementById('signupPasswordConfirm').value;
  const nickname = document.getElementById('signupNickname').value;
  const userType = document.getElementById('signupUserType').value;

  // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
  if (password !== passwordConfirm) {
    showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
    return;
  }

// 229ë²ˆ ë¼ì¸ ë¶€ê·¼ë¶€í„° ì£¼ì„ ì²˜ë¦¬ ì‹œì‘
/* const response = await fetch('tables/users', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            email: email,
            password: hashedPassword,
            nickname: nickname,
            user_type: userType,
            profile_image: '',
            created_at: new Date().toISOString(),
            last_login: new Date().toISOString(),
            status: 'active'
        })
    });
*/ // ì£¼ì„ ì²˜ë¦¬ ë

    if (response.ok) {
      const newUser = await response.json();
      showToast('ğŸ‰ íšŒì›ê°€ì… ì™„ë£Œ!', 'success');
      
      // ìë™ ë¡œê·¸ì¸: localStorageì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
      localStorage.setItem('trex_user', JSON.stringify({
        id: newUser.id,
        email: newUser.email,
        nickname: newUser.nickname,
        user_type: newUser.user_type,
        profile_image: newUser.profile_image,
        created_at: newUser.created_at
      }));
      
      // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 1000);
    } else {
      const errorText = await response.text();
      throw new Error(errorText);
    }
  } catch (error) {
    console.error('Signup error:', error);
    showToast('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + error.message, 'error');
  }
}

// ë¡œê·¸ì¸ ì²˜ë¦¬
async function handleLogin(event) {
  event.preventDefault();

  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  const hashedPassword = await simpleHash(password);

  try {
    // ì‚¬ìš©ì ì¡°íšŒ
    const response = await fetch(`tables/users?search=${encodeURIComponent(email)}`);
    const data = await response.json();

    if (data.data && data.data.length > 0) {
      const user = data.data.find(u => u.email === email);
      
      if (user && user.password === hashedPassword) {
        // ë¡œê·¸ì¸ ì„±ê³µ
        showToast('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
        
        // ì„¸ì…˜ ì €ì¥
        localStorage.setItem('trex_user', JSON.stringify({
          id: user.id,
          email: user.email,
          nickname: user.nickname,
          user_type: user.user_type,
          profile_image: user.profile_image,
          created_at: user.created_at
        }));

        // ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
        await fetch(`tables/users/${user.id}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            last_login: new Date().toISOString()
          })
        });

        // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1000);
      } else {
        showToast('ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
      }
    } else {
      showToast('ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤', 'error');
    }
  } catch (error) {
    console.error('Login error:', error);
    showToast('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message, 'error');
  }
}

// ê°„ë‹¨í•œ ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ í•¨ìˆ˜ (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ bcrypt ì‚¬ìš© ê¶Œì¥)
async function simpleHash(str) {
  const encoder = new TextEncoder();
  const data = encoder.encode(str);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

// í† ìŠ¤íŠ¸ ì•Œë¦¼
function showToast(message, type = 'success') {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
  const icon = type === 'success' ? 'check-circle' : 'exclamation-circle';
  
  toast.className = `${bgColor} text-white px-6 py-4 rounded-lg shadow-lg flex items-center gap-3 animate-slide-in`;
  toast.innerHTML = `
    <i class="fa-solid fa-${icon} text-xl"></i>
    <span>${message}</span>`;
  
  container.appendChild(toast);
  
  setTimeout(() => { 
    toast.style.opacity = '0'; 
    toast.style.transform = 'translateX(100px)';
    toast.style.transition = 'all 0.3s';
    setTimeout(() => toast.remove(), 300); 
  }, 3000);
}
</script>

<style>
@keyframes slide-in {
  from { opacity: 0; transform: translateX(100px); }
  to { opacity: 1; transform: translateX(0); }
}
.animate-slide-in { animation: slide-in 0.3s ease-out; }
</style>

</body>
</html>