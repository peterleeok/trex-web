<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Experience | Trex.so</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Google Fonts: Inter & Montserrat -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&family=Montserrat:wght@300;400;600;900&display=swap" rel="stylesheet">
    
    <!-- SpaceX Design System -->
    <link rel="stylesheet" href="css/spacex-design-system.css">
    
    <style>
        .upload-zone {
            transition: all 0.2s ease;
        }
        
        .upload-zone:hover {
            border-color: #00AEF0;
            background: rgba(0, 174, 240, 0.05);
        }
        
        .upload-zone.dragover {
            border-color: #00AEF0;
            background: rgba(0, 174, 240, 0.1);
        }
        
        .preview-image {
            position: relative;
            overflow: hidden;
        }
        
        .preview-image img {
            transition: transform 0.2s ease;
        }
        
        .preview-image:hover img {
            transform: scale(1.05);
        }
        
        .remove-image {
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .preview-image:hover .remove-image {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="spacex-nav">
        <div class="spacex-container">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <a href="index.html" class="flex items-center space-x-3">
                    <img src="images/trex-logo-full.png" alt="Trex.so - Travel. Assemble. Play." class="h-8 w-auto">
                    <span class="text-xl font-bold tracking-tight">Trex.so</span>
                </a>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="spacex-nav-link">홈</a>
                    <a href="creator-studio.html" class="spacex-nav-link">크리에이터 스튜디오</a>
                    <a href="upload.html" class="spacex-nav-link-active">경험 업로드</a>
                    <a href="market.html" class="spacex-nav-link">블록 마켓</a>
                </div>
                
                <!-- Auth Buttons -->
                <div class="flex items-center space-x-4">
                    <div id="authButtons">
                        <a href="login.html" class="spacex-btn-secondary text-sm px-4 py-2">로그인</a>
                    </div>
                    
                    <!-- Mobile Menu Toggle -->
                    <button id="mobileMenuBtn" class="md:hidden p-2">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobileMenu" class="hidden md:hidden mt-4 pb-4 border-t border-gray-800 pt-4">
                <div class="flex flex-col space-y-3">
                    <a href="index.html" class="spacex-nav-link">홈</a>
                    <a href="creator-studio.html" class="spacex-nav-link">크리에이터 스튜디오</a>
                    <a href="upload.html" class="spacex-nav-link-active">경험 업로드</a>
                    <a href="market.html" class="spacex-nav-link">블록 마켓</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="pt-40 pb-12">
        <div class="spacex-container text-center">
            <div class="inline-block px-4 py-2 bg-[#121212] border border-[#00AEF0] rounded-sm mb-6">
                <i class="fas fa-coins mr-2 text-[#00AEF0]"></i>
                <span class="text-sm font-bold">Creator Revenue</span>
            </div>
            
            <h1 class="spacex-headline mb-4">Upload Your Experience</h1>
            <p class="spacex-body-large text-gray-400 max-w-2xl mx-auto">
                사진과 간단한 설명만 있으면 됩니다.<br>
                AI가 자동으로 분석하여 여행자들이 구매할 수 있는 블록으로 변환합니다.
            </p>
        </div>
    </section>

    <!-- Upload Form -->
    <section class="pb-20">
        <div class="spacex-container">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Left: Image Upload -->
                <div class="spacex-card">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-image mr-3 text-[#00AEF0]"></i>
                        여행 사진 업로드
                    </h3>
                    
                    <!-- Upload Zone -->
                    <div id="uploadZone" 
                         class="upload-zone border-2 border-dashed border-gray-800 rounded-sm p-12 text-center cursor-pointer mb-6"
                         onclick="document.getElementById('fileInput').click()">
                        <div class="w-16 h-16 bg-[#121212] border border-[#00AEF0] rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-camera text-2xl text-[#00AEF0]"></i>
                        </div>
                        <p class="font-bold mb-2">사진을 업로드하세요</p>
                        <p class="text-sm text-gray-400 mb-2">클릭하거나 드래그하여 사진 추가</p>
                        <p class="text-xs text-gray-500">JPG, PNG 최대 5MB</p>
                    </div>
                    
                    <input type="file" 
                           id="fileInput" 
                           accept="image/*" 
                           multiple 
                           class="hidden">
                    
                    <!-- Image Previews -->
                    <div id="imagePreview" class="grid grid-cols-2 gap-4">
                        <!-- Preview images will be added here -->
                    </div>
                    
                    <!-- Upload Progress -->
                    <div id="uploadProgress" class="hidden mt-6">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-gray-400">업로드 중...</span>
                            <span id="progressPercent" class="text-sm font-bold text-[#00AEF0]">0%</span>
                        </div>
                        <div class="w-full bg-[#121212] rounded-full h-2 overflow-hidden">
                            <div id="progressBar" class="bg-[#00AEF0] h-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Right: Block Details -->
                <div class="spacex-card">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-pen mr-3 text-[#00AEF0]"></i>
                        블록 정보 입력
                    </h3>
                    
                    <form id="uploadForm" class="space-y-6">
                        <!-- Title -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-400 mb-2">
                                제목 *
                            </label>
                            <input type="text" 
                                   id="blockTitle" 
                                   required
                                   placeholder="예: 홍대 맛집 카페 투어"
                                   class="w-full bg-[#121212] border border-gray-800 text-white px-4 py-3 rounded-sm focus:outline-none focus:border-[#00AEF0]">
                        </div>
                        
                        <!-- Category -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-400 mb-2">
                                카테고리 *
                            </label>
                            <select id="blockCategory" 
                                    required
                                    class="w-full bg-[#121212] border border-gray-800 text-white px-4 py-3 rounded-sm focus:outline-none focus:border-[#00AEF0]">
                                <option value="">카테고리 선택</option>
                                <option value="식당">식당</option>
                                <option value="카페">카페</option>
                                <option value="K-뷰티">K-뷰티</option>
                                <option value="관광지">관광지</option>
                                <option value="쇼핑">쇼핑</option>
                                <option value="기타">기타</option>
                            </select>
                        </div>
                        
                        <!-- Location -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-400 mb-2">
                                위치 *
                            </label>
                            <input type="text" 
                                   id="blockLocation" 
                                   required
                                   placeholder="예: Seoul, Hongdae"
                                   class="w-full bg-[#121212] border border-gray-800 text-white px-4 py-3 rounded-sm focus:outline-none focus:border-[#00AEF0]">
                        </div>
                        
                        <!-- Description -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-400 mb-2">
                                설명 *
                            </label>
                            <textarea id="blockDescription" 
                                      required
                                      rows="4"
                                      placeholder="이 경험에 대한 자세한 설명을 작성해주세요..."
                                      class="w-full bg-[#121212] border border-gray-800 text-white px-4 py-3 rounded-sm focus:outline-none focus:border-[#00AEF0] resize-none"></textarea>
                        </div>
                        
                        <!-- Price -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-400 mb-2">
                                가격 (USD) *
                            </label>
                            <div class="relative">
                                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">$</span>
                                <input type="number" 
                                       id="blockPrice" 
                                       required
                                       step="0.01"
                                       min="0.99"
                                       value="0.99"
                                       class="w-full bg-[#121212] border border-gray-800 text-white pl-8 pr-4 py-3 rounded-sm focus:outline-none focus:border-[#00AEF0]">
                            </div>
                            <p class="text-xs text-gray-500 mt-1">최소 $0.99</p>
                        </div>
                        
                        <!-- Tags -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-400 mb-2">
                                태그 (선택사항)
                            </label>
                            <input type="text" 
                                   id="blockTags" 
                                   placeholder="예: 커피, 브런치, 인스타그램"
                                   class="w-full bg-[#121212] border border-gray-800 text-white px-4 py-3 rounded-sm focus:outline-none focus:border-[#00AEF0]">
                            <p class="text-xs text-gray-500 mt-1">쉼표로 구분</p>
                        </div>
                        
                        <!-- Submit Button -->
                        <div class="pt-4 border-t border-gray-800">
                            <button type="submit" 
                                    id="submitBtn"
                                    class="spacex-btn-primary w-full">
                                <i class="fas fa-check mr-2"></i>블록 생성하기
                            </button>
                            
                            <p class="text-xs text-gray-500 text-center mt-4">
                                제출 후 검토 과정을 거쳐 승인됩니다
                            </p>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Info Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-12">
                <div class="spacex-card text-center">
                    <div class="w-12 h-12 bg-[#00AEF0] rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-robot text-xl text-black"></i>
                    </div>
                    <h3 class="font-bold mb-2">AI 자동 분석</h3>
                    <p class="text-sm text-gray-400">
                        AI가 사진을 분석하여 자동으로 최적의 블록을 생성합니다
                    </p>
                </div>
                
                <div class="spacex-card text-center">
                    <div class="w-12 h-12 bg-[#00AEF0] rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-globe text-xl text-black"></i>
                    </div>
                    <h3 class="font-bold mb-2">글로벌 마켓</h3>
                    <p class="text-sm text-gray-400">
                        전 세계 여행자들이 당신의 블록을 구매할 수 있습니다
                    </p>
                </div>
                
                <div class="spacex-card text-center">
                    <div class="w-12 h-12 bg-[#00AEF0] rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-dollar-sign text-xl text-black"></i>
                    </div>
                    <h3 class="font-bold mb-2">수익 창출</h3>
                    <p class="text-sm text-gray-400">
                        매 판매마다 수익을 얻고 크리에이터로 성장하세요
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="border-t border-gray-900 py-12">
        <div class="spacex-container text-center text-gray-500">
            <p class="mb-2">&copy; 2026 Trex.so. All rights reserved.</p>
            <p class="text-sm">Travel. Assemble. Play.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/auth.js"></script>
    <script>
        let uploadedImages = [];
        
        // Check login on page load
        document.addEventListener('DOMContentLoaded', () => {
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            
            if (!user) {
                alert('로그인이 필요합니다.');
                window.location.href = 'login.html';
                return;
            }
            
            updateAuthUI(user);
        });
        
        // Update auth UI
        function updateAuthUI(user) {
            const authButtons = document.getElementById('authButtons');
            if (user) {
                authButtons.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <a href="profile.html" class="spacex-nav-link flex items-center">
                            <i class="fas fa-user-circle mr-2"></i>
                            ${user.name}
                        </a>
                        <button onclick="logout()" class="spacex-btn-secondary text-sm px-4 py-2">
                            로그아웃
                        </button>
                    </div>
                `;
            }
        }
        
        // Logout
        function logout() {
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }
        
        // File input change handler
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);
        
        // Upload zone drag and drop
        const uploadZone = document.getElementById('uploadZone');
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });
        
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });
        
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length > 0) {
                handleFiles(imageFiles);
            }
        });
        
        // Handle file select
        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            handleFiles(files);
        }
        
        // Handle files
        function handleFiles(files) {
            files.forEach(file => {
                // Validate file size (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert(`${file.name}은(는) 5MB를 초과합니다.`);
                    return;
                }
                
                // Read file
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    const imageData = {
                        file: file,
                        dataUrl: e.target.result,
                        id: Date.now() + Math.random()
                    };
                    
                    uploadedImages.push(imageData);
                    renderImagePreviews();
                };
                
                reader.readAsDataURL(file);
            });
        }
        
        // Render image previews
        function renderImagePreviews() {
            const preview = document.getElementById('imagePreview');
            
            preview.innerHTML = uploadedImages.map((img, index) => `
                <div class="preview-image relative bg-[#121212] border border-gray-800 rounded-sm overflow-hidden group">
                    <img src="${img.dataUrl}" alt="Preview ${index + 1}" class="w-full h-40 object-cover">
                    
                    <button onclick="removeImage(${index})" 
                            class="remove-image absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full hover:bg-red-600 transition-all">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="absolute bottom-0 left-0 right-0 bg-black/80 px-3 py-2">
                        <p class="text-xs text-gray-300 truncate">${img.file.name}</p>
                    </div>
                </div>
            `).join('');
        }
        
        // Remove image
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            renderImagePreviews();
        }
        
        // Form submit handler
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Validate images
            if (uploadedImages.length === 0) {
                alert('최소 1개 이상의 사진을 업로드해주세요.');
                return;
            }
            
            // Get form data
            const user = JSON.parse(localStorage.getItem('user'));
            const formData = {
                title: document.getElementById('blockTitle').value,
                category: document.getElementById('blockCategory').value,
                location: document.getElementById('blockLocation').value,
                description: document.getElementById('blockDescription').value,
                price: parseFloat(document.getElementById('blockPrice').value),
                tags: document.getElementById('blockTags').value.split(',').map(t => t.trim()).filter(t => t),
                images: uploadedImages.map(img => img.dataUrl),
                creatorEmail: user.email,
                creatorName: user.name,
                status: 'pending',
                rating: 0,
                purchases: 0,
                created_at: Date.now()
            };
            
            // Show progress
            const submitBtn = document.getElementById('submitBtn');
            const uploadProgress = document.getElementById('uploadProgress');
            
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>생성 중...';
            uploadProgress.classList.remove('hidden');
            
            // Simulate upload progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 10;
                if (progress <= 90) {
                    document.getElementById('progressBar').style.width = progress + '%';
                    document.getElementById('progressPercent').textContent = progress + '%';
                }
            }, 200);
            
            try {
                // Save to database
                const response = await fetch('tables/blocks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) throw new Error('Upload failed');
                
                // Complete progress
                clearInterval(progressInterval);
                document.getElementById('progressBar').style.width = '100%';
                document.getElementById('progressPercent').textContent = '100%';
                
                // Success
                setTimeout(() => {
                    alert('블록이 성공적으로 생성되었습니다!\n검토 후 승인되면 마켓에 표시됩니다.');
                    window.location.href = 'creator-studio.html';
                }, 500);
                
            } catch (error) {
                console.error('Error uploading block:', error);
                alert('블록 생성 중 오류가 발생했습니다. 다시 시도해주세요.');
                
                clearInterval(progressInterval);
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-check mr-2"></i>블록 생성하기';
                uploadProgress.classList.add('hidden');
            }
        });
        
        // Mobile menu toggle
        document.getElementById('mobileMenuBtn').addEventListener('click', () => {
            const menu = document.getElementById('mobileMenu');
            const icon = document.querySelector('#mobileMenuBtn i');
            
            menu.classList.toggle('hidden');
            icon.classList.toggle('fa-bars');
            icon.classList.toggle('fa-times');
        });
    </script>
</body>
</html>
